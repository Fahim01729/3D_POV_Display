#include <SPI.h>

const byte image[25][7][8] = {
	// Slice 0
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 1
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 2
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 3
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 4
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 5
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 6
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 7
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 8
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 9
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 10
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 11
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 12
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 13
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 14
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 15
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 16
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 17
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 18
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 19
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 20
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 21
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 22
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 23
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
	// Slice 24
	{
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000},
		{0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000, 0b000}
	},
};

#include <SPI.h>

const int numLEDs = 32;  // Total number of LEDs
const int numRows = 4;   // Number of rows
const int LEDsPerRow = 8; // LEDs per row
const int hallPin = 2;  // Hall sensor pin
const int DATA_PIN = 11;
const int CLOCK_PIN = 13;

extern const byte imagePatterns[NUM_FRAMES][NUM_ROWS][NUM_COLS][3];  // Declare the array with LED patterns

SPISettings mySettings(12000000, MSBFIRST, SPI_MODE0);  // SPI settings

void setup() {
    pinMode(hallPin, INPUT_PULLUP);
    pinMode(DATA_PIN, OUTPUT);
    pinMode(CLOCK_PIN, OUTPUT);
    SPI.begin();
    attachInterrupt(digitalPinToInterrupt(hallPin), onMagnetDetected, FALLING);
}

void loop() {
    // Main loop does nothing; updates are triggered by the hall sensor interrupt
}

void onMagnetDetected() {
    static unsigned long lastUpdateTime = 0;
    unsigned long currentTime = millis();

    if (currentTime - lastUpdateTime > 1000) {
        updateLEDs();
        lastUpdateTime = currentTime;
    }
}
void updateLEDs() {
    SPI.beginTransaction(mySettings);  // Begin SPI transaction
    // Example loop for sending LED data based on imagePatterns
    for (int frame = 0; frame < NUM_FRAMES; frame++) {
        for (int row = 0; row < NUM_ROWS; row++) {
            for (int col = 0; col < NUM_COLS; col++) {
                byte r = imagePatterns[frame][row][col][0];
                byte g = imagePatterns[frame][row][col][1];
                byte b = imagePatterns[frame][row][col][2];
                // Send the RGB data for each pixel
                SPI.transfer(r);
                SPI.transfer(g);
                SPI.transfer(b);
            }
        }
    }
    SPI.endTransaction();
}

