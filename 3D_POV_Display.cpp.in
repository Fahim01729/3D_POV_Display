#include <Arduino.h>
#include <SPI.h>

// Define the pin connections and settings
const int DATA_PIN = 11;
const int CLOCK_PIN = 13;
const int HALL_SENSOR_PIN = 2;  // Hall sensor for detecting the magnet position

// LED Display configuration
const int NUM_FRAMES = 25;
const int NUM_ROWS = 7;
const int NUM_COLS = 8;



// SPI settings for SK9822 (adjust clock speed as necessary for your setup)
SPISettings spiSettings(12000000, MSBFIRST, SPI_MODE0);

// Variables for frame timing and synchronization
volatile int currentFrame = 0;
volatile bool newFrameReady = false;

void setup() {
  pinMode(HALL_SENSOR_PIN, INPUT_PULLUP);
  SPI.begin();

  // Attach an interrupt to the hall sensor pin
  attachInterrupt(digitalPinToInterrupt(HALL_SENSOR_PIN), onMagnetDetected, FALLING);
}

void loop() {
  if (newFrameReady) {
    updateLEDs();
    newFrameReady = false;
  }
}

void onMagnetDetected() {
  // Increment frame index and wrap around if necessary
  currentFrame = (currentFrame + 1) % NUM_FRAMES;
  newFrameReady = true;
}

void updateLEDs() {
  SPI.beginTransaction(spiSettings);

  // Send the data for the current frame
  for (int row = 0; row < NUM_ROWS; row++) {
    for (int col = 0; col < NUM_COLS; col++) {
      SPI.transfer(image[currentFrame][row][col]);
    }
  }

  SPI.endTransaction();
}

// Define the image array in your separate C++ file or directly in this sketch if preferred
